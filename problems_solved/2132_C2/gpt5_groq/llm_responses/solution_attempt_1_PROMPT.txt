=== LLM PROMPT (Solution Generation) ===
Attempt: 1
Timestamp: 2025-11-25T05:02:54
Model: gpt-5
Workflow: gpt5_groq

====================================================================

You are a competitive programming expert.

**Problem: 2132_C2**

This is the hard version of the problem. The easy version differs from the hard one in that it requires determining the minimum cost with the least number of deals, while the hard version requires determining the minimum cost with a limited number of deals.After the cunning seller sold three watermelons instead of one, he decided to increase his profit — namely, he bought even more watermelons. Now he can sell 3^x watermelons for 3^{x+1} + x · 3^{x-1} coins, where x is a non-negative integer. Such a sale is called a deal.A calculating buyer came to him, but he has little time, so the buyer can make no more than k deals and plans to buy exactly n watermelons.The buyer is in a hurry and has therefore turned to you to determine the minimum number of coins he must pay the seller for n watermelons if he makes no more than k deals. If it is impossible to buy exactly n watermelons while making no more than k deals, output -1.

**Task:** Please provide a well-structured and optimized C++ solution.
